<!DOCTYPE html>
<!-- Compensatory Leave Management - Admin can add or deduct compensatory leave (補假/扣假) -->
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Compensatory Leave - HR Leave Management System</title>
    <link href="https://cdn.jsdelivr.net/npm/tailwindcss@2.2.19/dist/tailwind.min.css" rel="stylesheet">
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.4.0/css/all.min.css">
    <link rel="stylesheet" href="../../css/styles.css">
</head>
<body>
    <div class="admin-layout">
        <!-- Sidebar -->
        <aside class="admin-sidebar">
            <div class="admin-sidebar-header">
                <i class="fas fa-calendar-check text-[#00AFB9] text-2xl mr-2"></i>
                <span class="admin-logo">HR System</span>
            </div>
            <nav class="sidebar-nav">
                <a href="dashboard.html" class="sidebar-nav-item">
                    <i class="fas fa-home"></i>
                    <span data-i18n="admin.dashboard">Dashboard</span>
                </a>
                <a href="approve-leaves.html" class="sidebar-nav-item">
                    <i class="fas fa-check-circle"></i>
                    <span data-i18n="admin.approveLeaves">Approve Leaves</span>
                </a>
                <a href="compensatory-leave.html" class="sidebar-nav-item active">
                    <i class="fas fa-plus-circle"></i>
                    <span data-i18n="admin.compensatory">Compensatory Leave</span>
                </a>
                <a href="manage-employees.html" class="sidebar-nav-item">
                    <i class="fas fa-users"></i>
                    <span data-i18n="admin.manageEmployees">Manage Employees</span>
                </a>
                <a href="leave-settings.html" class="sidebar-nav-item">
                    <i class="fas fa-cog"></i>
                    <span data-i18n="admin.settings">Leave Settings</span>
                </a>
                <a href="reports.html" class="sidebar-nav-item">
                    <i class="fas fa-chart-bar"></i>
                    <span data-i18n="admin.reports">Reports</span>
                </a>
                <div class="mt-auto pt-4 border-t border-white border-opacity-10">
                    <a href="../login.html" onclick="logout()" class="sidebar-nav-item">
                        <i class="fas fa-sign-out-alt"></i>
                        <span data-i18n="nav.logout">Logout</span>
                    </a>
                </div>
            </nav>
        </aside>

        <!-- Main Content -->
        <div class="admin-content">
            <!-- Top Header -->
            <header class="admin-header">
                <div class="flex items-center">
                    <h1 class="text-xl font-bold" data-i18n="admin.compensatory">Compensatory Leave</h1>
                </div>
                <div class="flex items-center gap-4">
                    <div class="lang-switcher relative">
                        <div class="flex items-center cursor-pointer" onclick="toggleLangDropdown()">
                            <i class="fas fa-globe text-white"></i>
                            <span class="current-lang ml-1 text-sm" id="currentLangText">EN</span>
                        </div>
                        <div class="dropdown-menu" id="langDropdown">
                            <div class="dropdown-item" data-lang="en" onclick="switchLanguage('en')">English</div>
                            <div class="dropdown-item" data-lang="zh" onclick="switchLanguage('zh')">繁體中文</div>
                        </div>
                    </div>
                    <div class="flex items-center">
                        <div class="text-right mr-3">
                            <p class="text-sm font-medium text-white">Administrator</p>
                            <p class="text-xs text-white opacity-80">admin</p>
                        </div>
                        <div class="w-10 h-10 rounded-full bg-white bg-opacity-20 flex items-center justify-center">
                            <i class="fas fa-user-shield text-white"></i>
                        </div>
                    </div>
                </div>
            </header>

            <!-- Main Content Area -->
            <main class="admin-main">
                <!-- Info -->
                <div class="admin-card mb-6 bg-blue-50 border border-blue-200">
                    <div class="flex items-start gap-2">
                        <i class="fas fa-info-circle text-blue-600 mt-0.5"></i>
                        <div class="text-sm text-blue-800">
                            <p class="font-medium mb-1" data-i18n="comp.infoTitle">Compensatory Leave Management</p>
                            <ul class="list-disc list-inside space-y-1 text-xs">
                                <li data-i18n="comp.info1">Positive days (+): Grant compensatory leave</li>
                                <li data-i18n="comp.info2">Negative days (-): Deduct leave balance</li>
                                <li data-i18n="comp.info3">Decimals allowed (e.g., +2.5, -1.5 days)</li>
                            </ul>
                        </div>
                    </div>
                </div>

                <!-- Add Compensatory Leave -->
                <div class="admin-card mb-6">
                    <h3 class="text-lg font-bold text-gray-800 mb-4">Add Compensatory Leave</h3>
                    <form id="compForm" class="grid grid-cols-4 gap-4 items-end">
                        <div class="col-span-1">
                            <label class="block text-xs font-medium text-gray-600 mb-1">Employee</label>
                            <select id="employeeSelect" class="w-full px-3 py-2 border border-gray-300 rounded-lg focus:ring-2 focus:ring-[#00AFB9] focus:border-[#00AFB9] text-sm">
                                <option value="">Select employee</option>
                            </select>
                        </div>
                        <div class="col-span-1">
                            <label class="block text-xs font-medium text-gray-600 mb-1">
                                <span data-i18n="comp.days">Days</span> 
                                <span class="text-gray-500" data-i18n="comp.daysHelper">(+ add / - deduct)</span>
                            </label>
                            <input type="number" step="0.5" id="compDays" placeholder="e.g. +2.5 or -1.5" class="w-full px-3 py-2 border border-gray-300 rounded-lg focus:ring-2 focus:ring-[#00AFB9] focus:border-[#00AFB9] text-sm">
                        </div>
                        <div class="col-span-1">
                            <label class="block text-xs font-medium text-gray-600 mb-1">Reason (optional)</label>
                            <input type="text" id="compReason" maxlength="200" class="w-full px-3 py-2 border border-gray-300 rounded-lg focus:ring-2 focus:ring-[#00AFB9] focus:border-[#00AFB9] text-sm">
                        </div>
                        <div class="col-span-1">
                            <button type="submit" class="w-full bg-[#00AFB9] hover:bg-[#009ba3] text-white font-bold py-2 px-4 rounded-lg">Add</button>
                        </div>
                    </form>
                </div>

                <!-- List -->
                <div class="admin-card">
                    <div class="flex items-center justify-between mb-3">
                        <h3 class="text-lg font-bold text-gray-800">Compensatory Leave Records</h3>
                        <div class="flex gap-2">
                            <input type="text" id="searchComp" placeholder="Search..." class="px-3 py-2 border border-gray-300 rounded-lg text-sm">
                        </div>
                    </div>
                    <div class="overflow-x-auto">
                        <table class="w-full">
                            <thead class="bg-gray-50 border-b-2 border-gray-200">
                                <tr>
                                    <th class="px-4 py-3 text-left text-xs font-medium text-gray-600">Employee</th>
                                    <th class="px-4 py-3 text-left text-xs font-medium text-gray-600">Days</th>
                                    <th class="px-4 py-3 text-left text-xs font-medium text-gray-600">Reason</th>
                                    <th class="px-4 py-3 text-left text-xs font-medium text-gray-600">Created</th>
                                    <th class="px-4 py-3 text-left text-xs font-medium text-gray-600">Actions</th>
                                </tr>
                            </thead>
                            <tbody id="compTableBody"></tbody>
                        </table>
                    </div>
                </div>
            </main>
        </div>
    </div>

    <script src="../../js/app.js"></script>
    <script>
        const employees = [
            { id: 1, name: '林劍明', code: 'L888' },
            { id: 2, name: '徐潔琛', code: 'E102' },
            { id: 3, name: '鄭國峰', code: 'M305' }
        ];

        const compRecords = [
            { id: 101, userId: 1, employee: '林劍明 (L888)', days: 1.5, reason: 'Overtime compensation', createdAt: '2025-10-15' },
            { id: 102, userId: 2, employee: '徐潔琛 (E102)', days: 2.0, reason: 'Weekend duty', createdAt: '2025-10-18' }
        ];

        document.addEventListener('DOMContentLoaded', function() {
            // Auth check
            const userRole = localStorage.getItem('userRole');
            if (userRole !== 'admin') {
                alert('Access denied. Admin privileges required.');
                window.location.href = '../login.html';
                return;
            }

            // Populate employees
            const sel = document.getElementById('employeeSelect');
            employees.forEach(e => {
                const opt = document.createElement('option');
                opt.value = e.id;
                opt.textContent = `${e.name} (${e.code})`;
                sel.appendChild(opt);
            });

            renderTable();

            document.getElementById('compForm').addEventListener('submit', function(e) {
                e.preventDefault();
                const userId = parseInt(document.getElementById('employeeSelect').value, 10);
                const days = parseFloat(document.getElementById('compDays').value);
                const reason = document.getElementById('compReason').value.trim();

                if (!userId || !days || days === 0) {
                    showNotification('Please select employee and enter valid days (cannot be zero)', 'error');
                    return;
                }

                // In production: POST /api/admin/compensatory-leave
                const emp = employees.find(x => x.id === userId);
                compRecords.unshift({
                    id: Date.now(),
                    userId,
                    employee: `${emp.name} (${emp.code})`,
                    days,
                    reason,
                    createdAt: new Date().toISOString().split('T')[0]
                });

                (document.getElementById('compForm')).reset();
                showNotification('Compensatory leave added', 'success');
                renderTable();
            });

            document.getElementById('searchComp').addEventListener('input', renderTable);
        });

        function renderTable() {
            const q = (document.getElementById('searchComp').value || '').toLowerCase();
            const tbody = document.getElementById('compTableBody');
            tbody.innerHTML = '';
            compRecords
              .filter(r => r.employee.toLowerCase().includes(q) || (r.reason||'').toLowerCase().includes(q))
              .forEach(r => {
                const tr = document.createElement('tr');
                tr.className = 'border-b border-gray-100 hover:bg-gray-50';
                
                // Color code based on positive (補假) or negative (扣假)
                const isPositive = r.days > 0;
                const daysColor = isPositive ? 'text-green-600' : 'text-red-600';
                const daysLabel = isPositive ? '補假' : '扣假';
                const daysDisplay = isPositive ? `+${r.days}` : r.days;
                
                tr.innerHTML = `
                    <td class="px-4 py-3 text-sm text-gray-800">${r.employee}</td>
                    <td class="px-4 py-3 text-sm font-bold ${daysColor}">
                        ${daysDisplay} 
                        <span class="text-xs font-normal text-gray-500">(${daysLabel})</span>
                    </td>
                    <td class="px-4 py-3 text-sm text-gray-700">${r.reason || '-'}</td>
                    <td class="px-4 py-3 text-sm text-gray-600">${formatDate(r.createdAt)}</td>
                    <td class="px-4 py-3">
                        <button class="text-red-600 hover:text-red-800 text-sm" onclick="deleteRecord(${r.id})">
                            <i class="fas fa-trash"></i>
                        </button>
                    </td>`;
                tbody.appendChild(tr);
              });
        }

        function deleteRecord(id) {
            if (!confirm('Delete this compensatory record?')) return;
            const idx = compRecords.findIndex(x => x.id === id);
            if (idx !== -1) compRecords.splice(idx, 1);
            showNotification('Deleted', 'success');
            renderTable();
        }

        function formatDate(dateStr) {
            const d = new Date(dateStr);
            const options = { year: 'numeric', month: 'short', day: 'numeric' };
            return d.toLocaleDateString('en-US', options);
        }

        function logout() {
            localStorage.removeItem('userRole');
            localStorage.removeItem('username');
            localStorage.removeItem('rememberMe');
        }
    </script>
</body>
</html>


